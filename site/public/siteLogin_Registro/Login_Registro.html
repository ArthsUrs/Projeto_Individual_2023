<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login e Registro</title>
    <link rel="stylesheet" href="StyleLogin.css">
    <script src="
https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.all.min.js
"></script>
    <link href="
https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.min.css
" rel="stylesheet">
<link rel="shortcut icon" href="../siteHome/imagesHome/imgPerso/TriforceGanon.png" type="image/x-con">

</head>

<body>
    <div class="title">
        <div class="color">
            <h1>
                The Legend of Zelda: <br>
                <h2>
                    Entre ou Registre-se
                </h2>
            </h1>
        </div>
    </div>

    <div class="login" id="login">
        <div class="container">
            <div class="formulario">
                <div class="image">
                    <img src="imagensLogin_Registro/fundoZeldaCortado2.png" alt="">
                </div>
                <div class="campos">
                    <div class="imagem">

                    </div>
                    <div class="titulo">
                        <h1>
                            Entre com seus dados:
                        </h1>
                    </div>
                    <div class="email">
                        <h1>
                            Login:
                        </h1>
                        <br>
                        <input type="text" id="i_LoginEmail" placeholder="Entre com seu email" required>
                    </div>
                    <div class="senha">
                        <h1>
                            Senha:
                        </h1>
                        <br>
                        <input type="password" id="i_LoginSenha" placeholder="Entre com seu email" required>
                        <br>
                    </div>
                    <div class="redirecionar">
                        <h3>Nao esta registrado ainda?</h3>
                        <p class="paragrafoRedirecionar" onclick="redirecionarToRegister()">
                            registre-se agora!
                        </p>
                        </a>
                    </div>
                    <button onclick="entrar()">
                        Entrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="register" id="register">
        <div class="container">
            <div class="forms">
                <div class="image">
                    <img src="imagensLogin_Registro/linkFundo.png" alt="">
                </div>
                <div class="campos">
                    <div class="titulo">
                        <h1>
                            Entre com os dados para cadastro
                        </h1>
                    </div>
                    <div class="email">
                        <h1>
                            Entre com o Email:
                        </h1>
                        <input type="text" placeholder="seuEmail@gmail.com" id="i_emailCadastro" required>
                    </div>
                    <div class="senha">
                        <h1>
                            Entre com a senha
                        </h1>
                        <br>
                        <input type="password" id="i_senhaCadastro" placeholder="Escolha uma boa senha" required>
                    </div>
                    <div class="nome">
                        <h1>
                            Entre com o seu Nickname:
                        </h1>
                        <input type="text" id="i_nomeCadastro" placeholder="Escolha um bom nome" required>
                    </div>

                    <div class="idade">
                        <h1>
                            Escolha um titulo preferido da serie!
                        </h1>
                        <select name="select_jogosPreferidos" id="select_jogosPreferidos">
                            <option value="1">
                                The Legend of Zelda: Skyward Sword
                            </option>
                            <option value="2">
                                The Legend of Zelda: Minish Cap
                            </option>
                            <option value="4">
                                The Legend of Zelda: Ocarina of Time
                            </option>
                            <option value="7">
                                The Legend of Zelda: A Link to the past
                            </option>
                            <option value="9">
                                The Legend of Zelda: Oracle of Seasons/Ages
                            </option>
                            <option value="10">
                                The Legend of Zelda
                            </option>
                            <option value="11">
                                Zelda II: adventure of Link
                            </option>
                            <option value="5">
                                The Legend of Zelda: Majora's Mask
                            </option>
                            <option value="6">
                                The Legend of Zelda: Twilight Princess
                            </option>
                            <option value="3">
                                The Legend of Zelda: Fours Swords
                            </option>
                            <option value="11">
                                The Legend of Zelda: The Wind Waker
                            </option>
                            <option value="12">
                                The Legend of Zelda: Phantom Hourglass
                            </option>
                            <option value="13">
                                The Legend of Zelda: Spirit Track
                            </option>
                            <option value="15">
                                The Legend of Zelda: Breath of The Wild
                            </option>
                            <option value="16">
                                The Legend of Zelda: Tears of the Kingdom
                            </option>
                            <option value="8">
                                The Legend of Zelda: Link's Awakening
                            </option>
                            <option value="14">
                                The Legend of Zelda: A link between worlds
                            </option>
                        </select>
                    </div>
                    <div class="redirecionar">
                        <h3><label for="paragrafoRedirecionar">Ja se registrou?</label></h3>
                        <p class="paragrafoRedirecionar" onclick="redirecionarToLogin()">
                            Entre com seu Login
                        </p>
                        </a>
                    </div>
                    <button onclick="cadastrar()">
                        Registre-se
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>

    var trocadorLogin = document.getElementById("login");
    var trocadorRegister = document.getElementById("register");

    function redirecionarToRegister() {
        trocadorLogin.style.display = "none";
        trocadorRegister.style.display = "flex"
    }

    function redirecionarToLogin() {
        trocadorRegister.style.display = "none"; trocadorLogin.style.display = "flex"
    }

    // CADASTRAR

    function cadastrar() {

        var emailVar = i_emailCadastro.value;
        var senhaVar = i_senhaCadastro.value;
        var nomeVar = i_nomeCadastro.value;
        var selectVar = select_jogosPreferidos.value;


        if (
            emailVar == "" ||
            senhaVar == "" ||
            nomeVar == "" ||
            selectVar == ""
        ) {
            Swal.fire({
                        title: "preencha todos os campos",
                        text: "O zelda está de olho em você",
                        imageUrl: "https://i.gifer.com/2Y0h.gif",
                        imageWidth: 500,
                        imageHeight: 300,
                        imageAlt: "Custom image"
                    });
            return false;
        }

        // Enviando o valor da nova input
        fetch("/usuario/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                nomeServer: nomeVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                selectServer: selectVar,
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    Swal.fire({
                        title: "Bem vindo!!",
                        text: "Cadastrado com sucesso, redirecionando para a tela de Logins",
                        imageUrl: "https://i.gifer.com/17mb.gif",
                        imageWidth: 500,
                        imageHeight: 300,
                        imageAlt: "Custom image"
                    });
                    setTimeout(function () {
                        window.location.href = "/siteLogin_Registro/Login_Registro.html"
                    }, 4000);
                }
                else {
                    Swal.fire({
                        title: "Não foi possível relizar o cadastro",
                        text: "confirme se suas informações estão correta ou pode ser que já exista uma conta cmo esse nome e email",
                        imageUrl: "https://i.gifer.com/1Y1t.gif",
                        imageWidth: 400,
                        imageHeight: 200,
                        imageAlt: "Custom image"
                    });
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
        return false;
    }
    // cadastrar


    // LOGIN

    function entrar() {
        var emailVar = i_LoginEmail.value;
        var senhaVar = i_LoginSenha.value;

        if (emailVar == "" || senhaVar == "") {
            Swal.fire({
                    title: "Preencha todos os campos!",
                    text: "o Zelda está de olho em você rapaz",
                    imageUrl: "https://i.gifer.com/2Y0h.gif",
                    imageWidth: 400,
                    imageHeight: 400,
                    imageAlt: "Custom image"
                });
            return false;
        }

        console.log("FORM LOGIN: ", emailVar);
        console.log("FORM SENHA: ", senhaVar);

        fetch("/usuario/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: emailVar,
                senhaServer: senhaVar
            })
        }).then(function (resposta) {

            if (resposta.ok) {
                Swal.fire({
                    title: "Bem vindo",
                    text: "Redirecionando para sua area, aguarde um momento",
                    imageUrl: "https://i.gifer.com/wfV.gif",
                    imageWidth: 400,
                    imageHeight: 400,
                    imageAlt: "Custom image"
                });

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NICKNAME = json.nickname;
                    sessionStorage.ID_USUARIO = json.id;
                });


                setTimeout(function () {
                    window.location.href = "/siteUsuario/IndexUser.html"
                }, 4000);
            } else {
                Swal.fire({
                    title: "Não foi possível realizar seu login",
                    text: " reveja se seus dados estão corretos",
                    imageUrl: "https://i.gifer.com/BZxL.gif",
                    imageWidth: 400,
                    imageHeight: 400,
                    imageAlt: "Custom image"
                });
                resposta.text().then(texto => {
                    console.error("erro");
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }


    // login
</script>